chrome.extension.onMessage.addListener(function (n) { if (n && n.action == "updateSelection") { var i, t; window.getSelection ? (i = window.getSelection(), i.rangeCount && (t = i.getRangeAt(0), t.deleteContents(), t.insertNode(document.createTextNode(n.text)))) : document.selection && document.selection.createRange && (t = document.selection.createRange(), t.text = n.text) } });